/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/tracery-grammar@2.8.4/tracery.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var tracery=function(){var t=Math.random,e=function(t,e,s){this.errors=[],void 0===s.raw&&(this.errors.push("Empty input for node"),s.raw=""),t instanceof tracery.Grammar?(this.grammar=t,this.parent=null,this.depth=0,this.childIndex=0):(this.grammar=t.grammar,this.parent=t,this.depth=t.depth+1,this.childIndex=e),this.raw=s.raw,this.type=s.type,this.isExpanded=!1,this.grammar||this.errors.push("No grammar specified for this node "+this)};function s(t,e){this.node=t;var s=e.split(":");this.target=s[0],1===s.length?this.type=2:(this.rule=s[1],"POP"===this.rule?this.type=1:this.type=0)}function i(t,e){this.raw=e,this.grammar=t,this.falloff=1,Array.isArray(e)?this.defaultRules=e:("string"==typeof e||e instanceof String)&&(this.defaultRules=[e])}e.prototype.toString=function(){return"Node('"+this.raw+"' "+this.type+" d:"+this.depth+")"},e.prototype.expandChildren=function(t,s){if(this.children=[],this.finishedText="",this.childRule=t,void 0!==this.childRule){var i=tracery.parse(t);i.errors.length>0&&(this.errors=this.errors.concat(i.errors));for(var r=0;r<i.length;r++)this.children[r]=new e(this,r,i[r]),s||this.children[r].expand(s),this.finishedText+=this.children[r].finishedText}else this.errors.push("No child rule provided, can't expand children")},e.prototype.expand=function(t){if(!this.isExpanded)switch(this.isExpanded=!0,this.expansionErrors=[],this.type){case-1:this.expandChildren(this.raw,t);break;case 0:this.finishedText=this.raw;break;case 1:this.preactions=[],this.postactions=[];var e=tracery.parseTag(this.raw);this.symbol=e.symbol,this.modifiers=e.modifiers;for(var i=0;i<e.preactions.length;i++)this.preactions[i]=new s(this,e.preactions[i].raw);for(i=0;i<e.postactions.length;i++);for(i=0;i<this.preactions.length;i++)0===this.preactions[i].type&&this.postactions.push(this.preactions[i].createUndo());for(i=0;i<this.preactions.length;i++)this.preactions[i].activate();this.finishedText=this.raw;var r=this.grammar.selectRule(this.symbol,this,this.errors);this.expandChildren(r,t);for(i=0;i<this.modifiers.length;i++){var a=this.modifiers[i],n=[];if(a.indexOf("(")>0){var h=/\(([^)]+)\)/.exec(this.modifiers[i]);if(!h||h.length<2);else{n=h[1].split(",");a=this.modifiers[i].substring(0,a.indexOf("("))}}var o=this.grammar.modifiers[a];o?this.finishedText=o(this.finishedText,n):(this.errors.push("Missing modifier "+a),this.finishedText+="((."+a+"))")}for(i=0;i<this.postactions.length;i++)this.postactions[i].activate();break;case 2:this.action=new s(this,this.raw),this.action.activate(),this.finishedText=""}},e.prototype.clearEscapeChars=function(){this.finishedText=this.finishedText.replace(/\\\\/g,"DOUBLEBACKSLASH").replace(/\\/g,"").replace(/DOUBLEBACKSLASH/g,"\\")},s.prototype.createUndo=function(){return 0===this.type?new s(this.node,this.target+":POP"):null},s.prototype.activate=function(){var t=this.node.grammar;switch(this.type){case 0:this.ruleSections=this.rule.split(","),this.finishedRules=[],this.ruleNodes=[];for(var s=0;s<this.ruleSections.length;s++){var i=new e(t,0,{type:-1,raw:this.ruleSections[s]});i.expand(),this.finishedRules.push(i.finishedText)}t.pushRules(this.target,this.finishedRules,this);break;case 1:t.popRules(this.target);break;case 2:t.flatten(this.target,!0)}},s.prototype.toText=function(){switch(this.type){case 0:return this.target+":"+this.rule;case 1:return this.target+":POP";case 2:return"((some function))";default:return"((Unknown Action))"}},i.prototype.selectRule=function(e){if(this.conditionalRule){var s=this.grammar.expand(this.conditionalRule,!0);if(this.conditionalValues[s])if(null!=(r=this.conditionalValues[s].selectRule(e)))return r}if(this.ranking)for(var i=0;i<this.ranking.length;i++){var r;if(null!=(r=this.ranking.selectRule()))return r}if(void 0!==this.defaultRules){var a=0,n=this.distribution;switch(n||(n=this.grammar.distribution),n){case"shuffle":this.shuffledDeck&&0!==this.shuffledDeck.length||(this.shuffledDeck=function(e,s){var i,r,a=e.length;for(;0!==a;)r=Math.floor(t()*a),i=e[a-=1],e[a]=e[r],e[r]=i;return e}(Array.apply(null,{length:this.defaultRules.length}).map(Number.call,Number),this.falloff)),a=this.shuffledDeck.pop();break;case"weighted":e.push("Weighted distribution not yet implemented");break;case"falloff":e.push("Falloff distribution not yet implemented");break;default:a=Math.floor(Math.pow(t(),this.falloff)*this.defaultRules.length)}return this.defaultUses||(this.defaultUses=[]),this.defaultUses[a]=++this.defaultUses[a]||1,this.defaultRules[a]}return e.push("No default rules defined for "+this),null},i.prototype.clearState=function(){this.defaultUses&&(this.defaultUses=[])};var r=function(t,e,s){this.key=e,this.grammar=t,this.rawRules=s,this.baseRules=new i(this.grammar,s),this.clearState()};r.prototype.clearState=function(){this.stack=[this.baseRules],this.uses=[],this.baseRules.clearState()},r.prototype.pushRules=function(t){var e=new i(this.grammar,t);this.stack.push(e)},r.prototype.popRules=function(){this.stack.pop()},r.prototype.selectRule=function(t,e){return this.uses.push({node:t}),0===this.stack.length?(e.push("The rule stack for '"+this.key+"' is empty, too many pops?"),"(("+this.key+"))"):this.stack[this.stack.length-1].selectRule()},r.prototype.getActiveRules=function(){return 0===this.stack.length?null:this.stack[this.stack.length-1].selectRule()},r.prototype.rulesToJSON=function(){return JSON.stringify(this.rawRules)};var a=function(t,e){this.modifiers={},this.loadFromRawObj(t)};function n(t){var e=t.toLowerCase();return"a"===e||"e"===e||"i"===e||"o"===e||"u"===e}a.prototype.clearState=function(){for(var t=Object.keys(this.symbols),e=0;e<t.length;e++)this.symbols[t[e]].clearState()},a.prototype.addModifiers=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.modifiers[e]=t[e])},a.prototype.loadFromRawObj=function(t){if(this.raw=t,this.symbols={},this.subgrammars=[],this.raw)for(var e in this.raw)this.raw.hasOwnProperty(e)&&(this.symbols[e]=new r(this,e,this.raw[e]))},a.prototype.createRoot=function(t){return new e(this,0,{type:-1,raw:t})},a.prototype.expand=function(t,e){var s=this.createRoot(t);return s.expand(),e||s.clearEscapeChars(),s},a.prototype.flatten=function(t,e){return this.expand(t,e).finishedText},a.prototype.toJSON=function(){for(var t=Object.keys(this.symbols),e=[],s=0;s<t.length;s++){var i=t[s];e.push(' "'+i+'" : '+this.symbols[i].rulesToJSON())}return"{\n"+e.join(",\n")+"\n}"},a.prototype.pushRules=function(t,e,s){void 0===this.symbols[t]?(this.symbols[t]=new r(this,t,e),s&&(this.symbols[t].isDynamic=!0)):this.symbols[t].pushRules(e)},a.prototype.popRules=function(t){this.symbols[t]||this.errors.push("Can't pop: no symbol for key "+t),this.symbols[t].popRules()},a.prototype.selectRule=function(t,e,s){if(this.symbols[t])return this.symbols[t].selectRule(e,s);for(var i=0;i<this.subgrammars.length;i++)if(this.subgrammars[i].symbols[t])return this.subgrammars[i].symbols[t].selectRule();return s.push("No symbol for '"+t+"'"),"(("+t+"))"};var h={replace:function(t,e){return t.replace(new RegExp(e[0].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e[1])},capitalizeAll:function(t){for(var e,s="",i=!0,r=0;r<t.length;r++)(e=t.charAt(r))>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"?i?(s+=t.charAt(r).toUpperCase(),i=!1):s+=t.charAt(r):(i=!0,s+=t.charAt(r));return s},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1)},a:function(t){if(t.length>0){if("u"===t.charAt(0).toLowerCase()&&t.length>2&&"i"===t.charAt(2).toLowerCase())return"a "+t;if(n(t.charAt(0)))return"an "+t}return"a "+t},firstS:function(t){console.log(t);var e=t.split(" "),s=h.s(e[0])+" "+e.slice(1).join(" ");return console.log(s),s},s:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":return t+"es";case"y":return n(t.charAt(t.length-2))?t+"s":t.substring(0,t.length-1)+"ies";default:return t+"s"}},ed:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":default:return t+"ed";case"e":return t+"d";case"y":return n(t.charAt(t.length-2))?t+"d":t.substring(0,t.length-1)+"ied"}}};return(tracery={createGrammar:function(t){return new a(t)},parseTag:function(t){for(var e={symbol:void 0,preactions:[],postactions:[],modifiers:[]},s=tracery.parse(t),i=void 0,r=0;r<s.length;r++)if(0===s[r].type){if(void 0!==i)throw"multiple main sections in "+t;i=s[r].raw}else e.preactions.push(s[r]);if(void 0===i);else{var a=i.split(".");e.symbol=a[0],e.modifiers=a.slice(1)}return e},parse:function(t){var e=0,s=!1,i=[],r=!1,a=[],n=0,h="",o=void 0;if(null===t)return(i=[]).errors=a,i;function l(e,s,r){var n;s-e<1&&(1===r&&a.push(e+": empty tag"),2===r&&a.push(e+": empty action")),n=void 0!==o?h+"\\"+t.substring(o+1,s):t.substring(e,s),i.push({type:r,raw:n}),o=void 0,h=""}for(var u=0;u<t.length;u++){if(r)r=!1;else switch(t.charAt(u)){case"[":0!==e||s||(n<u&&l(n,u,0),n=u+1),e++;break;case"]":0!==--e||s||(l(n,u,2),n=u+1);break;case"#":0===e&&(s?(l(n,u,1),n=u+1):(n<u&&l(n,u,0),n=u+1),s=!s);break;case"\\":r=!0,h+=t.substring(n,u),n=u+1,o=u}}return n<t.length&&l(n,t.length,0),s&&a.push("Unclosed tag"),e>0&&a.push("Too many ["),e<0&&a.push("Too many ]"),(i=i.filter((function(t){return 0!==t.type||0!==t.raw.length}))).errors=a,i}}).baseEngModifiers=h,tracery.TraceryNode=e,tracery.Grammar=a,tracery.Symbol=r,tracery.RuleSet=i,tracery.setRng=function(e){t=e},tracery}();module.exports=tracery;
//# sourceMappingURL=/sm/c19570d6223fc84a98b81c1e696a01260387a3b4232df95ba22a171fa8620b2c.map