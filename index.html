<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tracery Story Generator</title>
  <link rel="stylesheet" href="style.css">
  <!-- Load jQuery, then p5 and Tracery -->
  <script src="jquery-3.7.1.min.js"></script>
  <script src="p5.min.js"></script>
  <script src="tracery.min.js"></script>
</head>
<body>
  <h1>Generated Science Fiction Story</h1>
  
  <script>
    window.onload = function() {
      let grammarData, traceryGrammar;
      // An array to hold falling texts with their position
      let fallingTexts = [];

      // p5 preload() loads external assets before setup()
      window.preload = function() {
        // Load the grammar JSON file from local disk
        grammarData = loadJSON('grammar.json');
      };

      window.setup = function() {
        // Create a full-window canvas
        createCanvas(windowWidth, windowHeight);
        background(0);
        fill('lime');        // Neon green fill for text
        textSize(32);
        textAlign(CENTER, CENTER);
        // Create the tracery grammar from the loaded JSON
        traceryGrammar = tracery.createGrammar(grammarData);
      };

      window.draw = function() {
        background(0);
        // Loop through each falling text, draw it, and update its y position
        for (let i = 0; i < fallingTexts.length; i++) {
          let item = fallingTexts[i];
          text(item.text, item.x, item.y);
          // Increase y so that text falls
          item.y += 1;
        }
      };

      // When the user clicks, generate new text at mouse location
      window.mousePressed = function() {
        // Generate the text using the "origin" rule
        let newText = traceryGrammar.flatten("#origin#");
        // Add new text object with starting position from the click
        fallingTexts.push({
          text: newText,
          x: mouseX,
          y: mouseY
        });
      };

      // Adjust canvas size on window resize
      window.windowResized = function() {
        resizeCanvas(windowWidth, windowHeight);
      };
    };
  </script>
</body>
</html>
